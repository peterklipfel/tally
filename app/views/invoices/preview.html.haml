.grid-12
  %h1 Invoice
  %table
    %tr
      %th Client
      %th Date Created
      %th Total
    %tr
      %td= @invoice.client.name
      %td= @invoice.created_at.strftime("%d/%m/%Y")
      %td= number_to_currency @invoice.total
  %h3 Line Items
  %table
    %tr
      %th Task
      %th Hours
      %th Rate
      %th Total
    - if @invoice.expenses.count > 0
      - @invoice.expenses.each do |expense|
        %tr
          %td= expense.task
          %td= expense.time
          %td= number_to_currency expense.rate
          %td= number_to_currency expense.total
    - else
      %tr
        %td{ colspan: 10 } This invoice does not have any line items
  .invoice-details
    %p All balances due are payable upon reception of invoice. Interest on past due balances is 18% per annum or 1.5% per month. Thank you for your business. We look forward to our continued working relationship during this process.
  - if signed_in?
    = link_to "Back to Invoice", invoice_path(@invoice), class: :button
  / = form_tag payments_path do

  = link_to "Pay Invoice", "#", class: :button, id: "pay-invoice-button"
  %script{ src: "https://checkout.stripe.com/checkout.js" }
  :coffeescript
    handler = StripeCheckout.configure(
      key: "#{Rails.configuration.stripe[:publishable_key]}"
      image: "/assets/logo@2x.png"
      token: (token, args) ->
    )
    document.getElementById("pay-invoice-button").addEventListener "click", (e) ->
      handler.open
        name: "Tally"
        description: "2 widgets ($20.00)"
        amount: 2000
      e.preventDefault()


